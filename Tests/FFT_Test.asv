% ============================================================
% Test Signal Generator
% 20s complex CW signal with frequency fd at fs = 48 kHz
% left: sin-signal and right: cos-signal (or viec versa) 
% ============================================================
clear; close all; clc;

% Parameter
% ============================================================
fs = 64;      % samplin frequency
fd = 160;      % Doppler frequency
N = fs;      % number of samples for 20s long signal
SPEED_OF_LIGHT = 299792458.0;
TRANSMIT_FREQUENCY = 24000000000.0;

% test signal
% ============================================================
t = (0:N-1)/fs; 
sig = 0.5*exp(-1i*2*pi*fd*t);
x(:,1) = real(sig);
x(:,2) = imag(sig);

% % rearange
% newArray = zeros(1, 2048);
% index = 1;
% for i = 1:1024
%     for j = 1:2
%         newArray(index) = x(i, j);
%         index = index + 1;
%     end
% end

% Perform FFT
X = fft(sig);

% Calculate magnitude
magX = abs(X);

% Find max value
[max_val, max_index] = max(magX);

% Calculate velocity
lambda = SPEED_OF_LIGHT / TRANSMIT_FREQUENCY;
velocity = (max_val*lambda) / 2.0;

% Display velocity
velocity = 3.6*velocity;
disp(['Velocity: ', num2str(velocity), ' km/h']);