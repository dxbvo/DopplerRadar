clear; close all; clc;

% test array x
fs = 30000;
x = single(0:255) / 10.0;
FFT_SIZE = 64;
SPEED_OF_LIGHT = 299792458.0;
TRANSMIT_FREQUENCY = 24000000000.0;
x = [0.0, 0.100000001, 0.200000003, 0.300000012, 0.400000006, 0.5, 0.600000024, 0.699999988, 0.800000012, 0.899999976, 1.0, 1.10000002, 1.20000005, 1.29999995, 1.39999998, 1.5, 1.60000002, 1.70000005, 1.79999995, 1.89999998, 2.0, 2.0999999, 2.20000005, 2.29999995, 2.4000001, 2.5, 2.5999999, 2.70000005, 2.79999995, 2.9000001, 3.0, 3.0999999, 3.20000005, 3.29999995, 3.4000001, 3.5, 3.5999999, 3.70000005, 3.79999995, 3.9000001, 4.0, 4.0999999, 4.19999981, 4.30000019, 4.4000001, 4.5, 4.5999999, 4.69999981, 4.80000019, 4.9000001, 5.0, 5.0999999, 5.19999981, 5.30000019, 5.4000001, 5.5, 5.5999999, 5.69999981, 5.80000019, 5.9000001, 6.0, 6.0999999, 6.19999981, 6.30000019, 6.4000001, 6.5, 6.5999999, 6.69999981, 6.80000019, 6.9000001, 7.0, 7.0999999, 7.19999981, 7.30000019, 7.4000001, 7.5, 7.5999999, 7.69999981, 7.80000019, 7.9000001, 8.0, 8.10000038, 8.19999981, 8.30000019, 8.39999962, 8.5, 8.60000038, 8.69999981, 8.80000019, 8.89999962, 9.0, 9.10000038, 9.19999981, 9.30000019, 9.39999962, 9.5, 9.60000038, 9.69999981, 9.80000019, 9.89999962, 10.0, 10.1000004, 10.1999998, 10.3000002, 10.3999996, 10.5, 10.6000004, 10.6999998, 10.8000002, 10.8999996, 11.0, 11.1000004, 11.1999998, 11.3000002, 11.3999996, 11.5, 11.6000004, 11.6999998, 11.8000002, 11.8999996, 12.0, 12.1000004, 12.1999998, 12.3000002, 12.3999996, 12.5, 12.6000004, 12.6999998, 12.8000002, 12.8999996, 13.0, 13.1000004, 13.1999998, 13.3000002, 13.3999996, 13.5, 13.6000004, 13.6999998, 13.8000002, 13.8999996, 14.0, 14.1000004, 14.1999998, 14.3000002, 14.3999996, 14.5, 14.6000004, 14.6999998, 14.8000002, 14.8999996, 15.0, 15.1000004, 15.1999998, 15.3000002, 15.3999996, 15.5, 15.6000004, 15.6999998, 15.8000002, 15.8999996, 16.0, 16.1000004, 16.2000008, 16.2999992, 16.3999996, 16.5, 16.6000004, 16.7000008, 16.7999992, 16.8999996, 17.0, 17.1000004, 17.2000008, 17.2999992, 17.3999996, 17.5, 17.6000004, 17.7000008, 17.7999992, 17.8999996, 18.0, 18.1000004, 18.2000008, 18.2999992, 18.3999996, 18.5, 18.6000004, 18.7000008, 18.7999992, 18.8999996, 19.0, 19.1000004, 19.2000008, 19.2999992, 19.3999996, 19.5, 19.6000004, 19.7000008, 19.7999992, 19.8999996, 20.0, 20.1000004, 20.2000008, 20.2999992, 20.3999996, 20.5, 20.6000004, 20.7000008, 20.7999992, 20.8999996, 21.0, 21.1000004, 21.2000008, 21.2999992, 21.3999996, 21.5, 21.6000004, 21.7000008, 21.7999992, 21.8999996, 22.0, 22.1000004, 22.2000008, 22.2999992, 22.3999996, 22.5, 22.6000004, 22.7000008, 22.7999992, 22.8999996, 23.0, 23.1000004, 23.2000008, 23.2999992, 23.3999996, 23.5, 23.6000004, 23.7000008, 23.7999992, 23.8999996, 24.0, 24.1000004, 24.2000008, 24.2999992, 24.3999996, 24.5, 24.6000004, 24.7000008, 24.7999992, 24.8999996, 25.0, 25.1000004, 25.2000008, 25.2999992, 25.3999996, 25.5];

% Perform FFT
X = fft(x);

% Calculate magnitude
magX = abs(X);

% Find max value
[max_val, max_index] = max(magX);

% Calculate velocity
dopplerFrequency = max_index*(fs/FFT_SIZE);
lambda = SPEED_OF_LIGHT / TRANSMIT_FREQUENCY;
velocity = (dopplerFrequency*lambda) / 2.0;

% Display velocity
velocity = 3.6*velocity;
disp(['Velocity: ', num2str(velocity), ' km/h']);






